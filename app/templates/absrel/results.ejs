<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet">
<link href="/assets/lib/phylotree/phylotree.css" rel="stylesheet">
<link href="/assets/lib/hyphy-vision/absrel/absrel.css" rel="stylesheet">

<div class = 'container-fluid'>

  <div class='tabbable content'>

    <ul class="nav nav-tabs">
      <li class="active"><a href="#summary_tab" data-toggle="tab">Summary</a></li>
      <li class=""><a href="#tree_tab" data-toggle="tab">Tree</a></li>
      <li class=""><a href="#table_tab" data-toggle="tab">Table</a></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane active" id = "summary_tab">
            <div class = "row" style = 'margin-top: 5px'>
                <div class = "col-md-12">
                    <ul class="list-group">
                      <li class="list-group-item list-group-item-info">
                        <h3 class="list-group-item-heading"><i class="fa fa-list" style = 'margin-right: 10px'>
                        </i><span id = 'summary-method-name'>Adaptive branch site REL</span> summary</h3>
                            <p class = "list-group-item-text lead" style = "margin-top:0.5em; ">
                                Evidence<sup>&dagger;</sup>
                                of episodic diversifying selection was found on <strong id = 'summary-selected-branches'></strong> out of <span id = 'summary-tested-branches'></span> tested branches (<span id = 'summary-total-branches'></span> total branches).
                            </p>
                            <p><small><sup>&dagger;</sup><abbr title = 'Likelihood Ratio Test'>LRT</abbr> p &le; 0.05, corrected for multiple testing.</small>                          
                                <br><small>Please cite <a href = '#' id = 'summary-pmid'>PMID XXX</a> if you use this result in a publication, presentation, or other scientific work.</small>
                             </p>
                       </li>
                    </ul>
                </div>
            </div>

               <div class = "row">
                    <div class = "col-md-6">
                        <ul class="list-group">
                          <li class="list-group-item">
                            <h4 class="list-group-item-heading"><i class="fa fa-tree" style = 'margin-right: 10px'>
                            </i>Tree</h4>
                                <table class = "table table-hover table-condensed list-group-item-text" style = "margin-top:0.5em;">
                                <thead>
                                    <tr>
                                        <th>&omega; rate <br>classes</th>
                                        <th># of <br>branches</th>
                                        <th>% of <br>branches</th>
                                        <th>% of tree <br>length</th>
                                        <th># under <br>selection</th>
                                   </tr>
                                </thead>       
                                   <tbody id = 'summary-tree-table'>
                                        
                                   </tbody>
                                    <caption style = 'caption-side: bottom; text-align: left; margin-top:1em;'>
                                    <p class = "list-group-item-text text-muted">
                                    Total tree length under the branch-site model is <strong id = 'summary-tree-length'></strong>    
                                    expected substitutions per nucleotide site, and <strong id = 'summary-tree-length-mg94'></strong>    
                                    under the MG94 model.
                                    </p>                
                                </caption>                                  
                                </table>                         
                           </li>
                        </ul>
                    </div>                
                    <div class = "col-md-6">
                    <ul class="list-group">
                      <li class="list-group-item">
                        <h4 class="list-group-item-heading"><i class="fa fa-cubes" style = 'margin-right: 10px'>
                        </i>Model fits</h4>
                            <table class = "table table-hover table-condensed list-group-item-text" style = "margin-top:0.5em;">
                                <thead>
                                    <tr>
                                        <th>Model</th>
                                        <th><em> log </em>L</th>
                                        <th><abbr title = "Number of estimated model parameters"># par.</abbr></th>
                                        <th><abbr title = "Small Sample AIC">AIC<sub>c</sub></abbr></th>
                                        <th>Time to fit</th>
                                   </tr>
                                </thead>
                               <tbody id = 'summary-model-table'>
                                    
                               </tbody>
                               
                               <caption style = 'caption-side: bottom; text-align: left; margin-top:1em;'>
                                    <p class = "list-group-item-text text-muted">
                                        The complete analysis took <strong id = 'summary-total-runtime'></strong> to finish, 
                                        of which <strong id = 'summary-complexity-runtime'></strong> was taken by the complexity analysis, 
                                        and <strong id = 'summary-testing-runtime'></strong> by selection testing.
                                    </p>                
                                </caption>                   
                            </table>                            
                       </li>
                    </ul>
                </div>
               </div>
        </div>
        <div class = 'tab-pane' id = "tree_tab">


            <div class = 'row'>
                    <div class = "col-md-4">
                           <div class="btn-group">
                            <button type="button" class="btn btn-default btn-sm" id = "expand_spacing">
                                <i class="fa fa-expand" ></i>
                            </button>
                             <button type="button" class="btn btn-default btn-sm" id = "compress_spacing">
                                <i class="fa fa-compress" ></i>
                            </button>
                          </div>
  
                    </div>
            </div>        

            <div class='row export-save-row'>
              <div class = "col-md-8">
                <div class="input-group input-group-sm input-group-btn">
                  <button id="export-phylo-svg" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-floppy-save"></span> SVG
                  </button>
                  <button id="export-phylo-png" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-floppy-save"></span> PNG
                  </button>
                </div>
              </div>
            </div>

            <div class = 'row'>
                <div class = 'col-md-1'>
                    <!--<div class = 'row'>
                        <div class="btn-toolbar" role="toolbar">
                          <div class="btn-group">
                            <button type="button" class="btn btn-default btn-sm" id = "expand_spacing">
                                <i class="fa fa-expand" ></i>
                            </button>
                             <button type="button" class="btn btn-default btn-sm" id = "compress_spacing">
                                <i class="fa fa-compress" ></i>
                            </button>
                          </div>
                       </div>
                    </div>-->
                     <div class = 'row'>
                        <div id = 'color_legend'>
                        </div>
                    </div>
                </div>
                <div class = 'col-md-11'>
                     <div class = 'row'>
                            <div id = 'tree_container' class = 'tree-widget'>
                            </div>
                     </div>
                        
                  </div>
            </div>
        </div>

        <div class = 'tab-pane' id = "table_tab"> 
                <div class = "row">
                    <div class = "col-md-12">
                        <table class = "table table-hover table-condensed" style = "margin-top:0.5em;">
                        <thead>
                            <tr>
                              <th>Name</th>
                              <th><abbr title = "Branch Length">B</abbr></th>
                              <th><abbr title = "Likelihood ratio test statistic">LRT</abbr></th>
                              <th>Test p-value</th>
                              <th>Uncorrected p-value</th>
                              <th>&omega; distribution over sites</th>
                           </tr>
                        </thead>       
                           <tbody id = 'table-branch-table'></tbody>
                        </table>                         
                    </div>  
                <div class = "col-md-5 hidden">
                    <div class="panel panel-default">
                      <div class="panel-heading" id = 'primary_omega_tag'></div>
                      <div class="panel-body">
                        <svg id = "primary_omega_plot"/> 
                      </div>
                    </div>
                </div>
                </div>
        </div>
    </div>
  </div>
</div>

<img id="chart-image" />
<canvas id="chart-canvas"></canvas>

<script>

  // *** HANDLERS ***
  $("#json_file").on ("change", function (e) {
    var files = e.target.files; // FileList object

    if (files.length == 1) {
      var f = files[0];
      var reader = new FileReader();

      reader.onload = (function(theFile) {
        return function(e) {
            analysis_data = JSON.parse (e.target.result);
            render_bs_rel (analysis_data);
        };
      })(f);
      reader.readAsText(f);
    }
  });

  $( document ).ready( function () {
    var absrel_id = $("#job-report").data("jobid")
    d3.json (absrel_id + "/results", function (json) {

      //var container_id = '#tree_container';
      var bsrel_app = datamonkey.absrel();
      bsrel_app(json);
      //datamonkey.absrel(, container_id);
    });

    $("#export-phylo-svg").on('click', function(e) { 
      datamonkey.save_image("svg", "#tree_container"); 
    });

    $("#export-phylo-png").on('click', function(e) { 
      datamonkey.save_image("png", "#tree_container"); 
    });

  });

</script>

